---
import Layout from '../../layouts/Layout.astro';
import { languages, useLegalTranslations, type Lang, defaultLang } from '../../i18n/ui';

export function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

interface Props {
  lang?: Lang;
}

const { lang: propLang } = Astro.props as Props;
const { lang: paramLang } = Astro.params as { lang?: Lang };
const lang = (propLang ?? paramLang ?? defaultLang) as Lang;
const t = useLegalTranslations(lang);

// Only add language prefix for non-default locales
const langPrefix = lang === defaultLang ? '' : `/${lang}`;

const disclaimer = t('privacy.body.disclaimer') as string;
const intro = t('privacy.body.intro') as string[];
const sections = t('privacy.body.sections') as Array<{
  title: string | null;
  blocks: Array<
    | { type: 'heading'; level: 'h3' | 'h4'; text: string }
    | { type: 'p'; text: string }
    | { type: 'ul'; items: string[] }
    | { type: 'ol'; items: string[] }
  >;
}>;
---

<Layout lang={lang}>
  <main class="privacy-page">
    <!-- Header Section -->
    <header class="privacy-header">
      <div class="header-content">
        <a href={`${langPrefix}/`} class="back-link">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 12H5M12 19l-7-7 7-7"/>
          </svg>
          {t('privacy.backToHome')}
        </a>
        <img src="/hoppy-logo.jpeg" alt="Hoppy logo" class="header-logo" />
      </div>
    </header>

    <!-- Privacy Policy Content -->
    <section class="privacy-content">
      <div class="content-wrapper">
        <h1>{t('privacy.title')}</h1>
        
        <p class="intro">
          <strong>{t('privacy.lastUpdated')}</strong>
        </p>

        {lang === 'tc' && disclaimer ? (
          <p class="intro">
            <strong>{disclaimer}</strong>{' '}
            <a href="/privacy">English</a>
          </p>
        ) : null}

        {Array.isArray(intro) ? intro.map((p: string) => <p class="intro">{p}</p>) : null}

        {/** Legal body now comes from structured i18n JSON: `privacy.body.sections` */}

        {Array.isArray(sections)
          ? sections.map((section) => (
              <div class="policy-section">
                {section?.title ? <h2>{section.title}</h2> : null}
                {Array.isArray(section?.blocks)
                  ? section.blocks.map((b) => {
                      if (b?.type === 'heading') {
                        return b.level === 'h3' ? <h3>{b.text}</h3> : <h4>{b.text}</h4>;
                      }
                      if (b?.type === 'p') return <p>{b.text}</p>;
                      if (b?.type === 'ul')
                        return (
                          <ul>
                            {Array.isArray(b.items) ? b.items.map((it) => <li>{it}</li>) : null}
                          </ul>
                        );
                      if (b?.type === 'ol')
                        return (
                          <ol>
                            {Array.isArray(b.items) ? b.items.map((it) => <li>{it}</li>) : null}
                          </ol>
                        );
                      return null;
                    })
                  : null}
              </div>
            ))
          : null}


      </div>
    </section>

    <!-- Footer -->
    <footer class="privacy-footer">
      <a href={`${langPrefix}/`} class="footer-link">
        <img src="/hoppy-logo.jpeg" alt="Hoppy logo" class="footer-logo" />
        <span>{t('privacy.returnHome')}</span>
      </a>
    </footer>
  </main>
</Layout>

<style>
  .privacy-page {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background-color: var(--hoppy-gray);
  }

  /* Header Section */
  .privacy-header {
    background: linear-gradient(135deg, var(--hoppy-blue) 0%, #35a3c9 100%);
    padding: 2rem 2rem 3rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  .header-content {
    max-width: 1000px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
  }

  .back-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--hoppy-white);
    text-decoration: none;
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
    align-self: flex-start;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    background-color: rgba(255, 255, 255, 0.1);
  }

  .back-link:hover {
    background-color: rgba(255, 255, 255, 0.2);
    transform: translateX(-5px);
  }

  .back-link svg {
    width: 20px;
    height: 20px;
  }

  .header-logo {
    width: 150px;
    height: auto;
    padding: 15px;
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
  }

  /* Content Section */
  .privacy-content {
    flex: 1;
    padding: 4rem 2rem;
  }

  .content-wrapper {
    max-width: 900px;
    margin: 0 auto;
    background-color: var(--hoppy-white);
    padding: 3rem;
    border-radius: 30px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
  }

  .content-wrapper h1 {
    color: var(--hoppy-navy);
    margin-bottom: 2rem;
    text-align: center;
    font-size: clamp(2rem, 4vw, 3rem);
  }

  .intro {
    font-size: 1.1rem;
    color: var(--hoppy-gray-dark);
    margin-bottom: 3rem;
    padding: 1.5rem;
    background-color: var(--hoppy-gray);
    border-radius: 15px;
    border-left: 4px solid var(--hoppy-blue);
  }

  .policy-section {
    margin-bottom: 3rem;
  }

  .policy-section:last-child {
    margin-bottom: 0;
  }

  .policy-section h2 {
    color: var(--hoppy-blue);
    font-size: clamp(1.5rem, 3vw, 2rem);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 3px solid var(--hoppy-blue);
  }

  .policy-section h3 {
    color: var(--hoppy-navy);
    font-size: clamp(1.2rem, 2.5vw, 1.6rem);
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  .policy-section h4 {
    color: var(--hoppy-navy);
    font-size: clamp(1rem, 2vw, 1.3rem);
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }

  .policy-section p {
    color: var(--hoppy-gray-dark);
    line-height: 1.9;
    margin-bottom: 1rem;
    font-size: 1.05rem;
  }

  .policy-section ul {
    margin: 1rem 0 1.5rem 2rem;
    color: var(--hoppy-gray-dark);
  }

  .policy-section ol {
    margin: 1rem 0 1.5rem 2rem;
    color: var(--hoppy-gray-dark);
  }

  .policy-section li {
    margin-bottom: 0.75rem;
    line-height: 1.8;
    font-size: 1.05rem;
  }

  .policy-section a {
    color: var(--hoppy-blue);
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    border-bottom: 2px solid transparent;
  }

  .policy-section a:hover {
    border-bottom: 2px solid var(--hoppy-blue);
  }

  .effective-date {
    background-color: var(--hoppy-gray);
    padding: 1rem;
    border-radius: 10px;
    margin-top: 1.5rem;
    text-align: center;
  }

  .effective-date strong {
    color: var(--hoppy-navy);
  }

  /* Footer */
  .privacy-footer {
    background-color: var(--hoppy-navy);
    padding: 3rem 2rem;
    text-align: center;
  }

  .footer-link {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
    text-decoration: none;
    color: var(--hoppy-white);
    font-size: 1.1rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .footer-link:hover {
    transform: translateY(-5px);
  }

  .footer-logo {
    width: 120px;
    height: auto;
    padding: 15px;
    background-color: var(--hoppy-white);
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
  }

  .footer-link span {
    color: var(--hoppy-white);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .privacy-header {
      padding: 1.5rem 1rem 2rem;
    }

    .content-wrapper {
      padding: 2rem 1.5rem;
      border-radius: 20px;
    }

    .privacy-content {
      padding: 2rem 1rem;
    }

    .policy-section ul {
      margin-left: 1.25rem;
    }

    .back-link {
      font-size: 0.9rem;
    }

    .header-logo {
      width: 120px;
    }
  }

  @media (max-width: 480px) {
    .content-wrapper {
      padding: 1.5rem 1rem;
    }

    .privacy-footer {
      padding: 2rem 1rem;
    }

    .footer-logo {
      width: 100px;
    }
  }
</style>


